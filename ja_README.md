<h1 align="center">OpenAI Codex CLI</h1>
<p align="center">ターミナルで動作する軽量なコーディングエージェント</p>

<p align="center"><code>npm i -g @openai/codex</code></p>

![CodexデモGIF: codex "explain this codebase to me"の使用例](./.github/demo.gif)

---

<details>
<summary><strong>目次</strong></summary>

- [実験的技術に関する免責事項](#実験的技術に関する免責事項)
- [クイックスタート](#クイックスタート)
- [なぜCodexなのか？](#なぜcodexなのか)
- [セキュリティモデルと権限](#セキュリティモデルと権限)
  - [プラットフォームサンドボックス詳細](#プラットフォームサンドボックス詳細)
- [システム要件](#システム要件)
- [CLIリファレンス](#cliリファレンス)
- [メモリとプロジェクトドキュメント](#メモリとプロジェクトドキュメント)
- [非対話型/CIモード](#非対話型ciモード)
- [レシピ](#レシピ)
- [インストール](#インストール)
- [設定](#設定)
- [FAQ](#faq)
- [資金提供の機会](#資金提供の機会)
- [貢献](#貢献)
  - [開発ワークフロー](#開発ワークフロー)
    - [Nix Flake開発](#nix-flake開発)
  - [高影響力のコード変更の作成](#高影響力のコード変更の作成)
  - [プルリクエストの作成](#プルリクエストの作成)
  - [レビュープロセス](#レビュープロセス)
  - [コミュニティの価値観](#コミュニティの価値観)
  - [ヘルプの入手](#ヘルプの入手)
  - [貢献者ライセンス契約（CLA）](#貢献者ライセンス契約cla)
    - [クイックフィックス](#クイックフィックス)
  - [`codex`のリリース](#codexのリリース)
- [セキュリティと責任あるAI](#セキュリティと責任あるai)
- [ライセンス](#ライセンス)
- [ゼロデータ保持（ZDR）組織制限](#ゼロデータ保持zdr組織制限)

</details>

---

## 実験的技術に関する免責事項

Codex CLIは現在開発中の実験的プロジェクトです。まだ安定しておらず、バグや未完成の機能が含まれている可能性があり、抜本的な変更が行われる可能性があります。私たちはコミュニティと共にオープンに開発を進めており、以下を歓迎します：

- バグ報告
- 機能リクエスト
- プルリクエスト
- ポジティブなコミュニケーション

問題の報告やPR、改善にご協力ください（貢献方法については以下のセクションを参照）！

## クイックスタート

グローバルにインストール：

```shell
npm install -g @openai/codex
```

次に、OpenAI APIキーを環境変数として設定：

```shell
export OPENAI_API_KEY="your-api-key-here"
```

> **注意:** このコマンドは現在のターミナルセッションでのみキーを設定します。永続的に設定するには、`export`行をシェルの設定ファイル（例：`~/.zshrc`）に追加してください。
>
> **ヒント:** APIキーをプロジェクトのルートにある`.env`ファイルに配置することもできます：
>
> ```env
> OPENAI_API_KEY=your-api-key-here
> ```
>
> CLIは自動的に`.env`から変数を読み込みます（`dotenv/config`経由）。

対話的に実行：

```shell
codex
```

または、プロンプトを入力として実行（オプションで`Full Auto`モード）：

```shell
codex "explain this codebase to me"
```

```shell
codex --approval-mode full-auto "create the fanciest todo-list app"
```

これで完了です - Codexはファイルをスキャフォールディングし、サンドボックス内で実行し、不足している依存関係をインストールし、その場で実行結果を表示します。変更を承認すると、作業ディレクトリにコミットされます。

---

## なぜCodexなのか？

Codex CLIは、すでに**ターミナルを使いこなしている**開発者向けに設計されています。ChatGPTレベルの推論能力**に加えて**、実際にコードを実行し、ファイルを操作し、反復する能力を提供します。つまり、リポジトリを理解し実行する_チャット駆動開発_です。

- **セットアップ不要** - OpenAI APIキーを持ってくれば、そのまま動作します！
- **完全な自動承認、かつ安全でセキュア** - ネットワーク無効化とディレクトリサンドボックス化により実現
- **マルチモーダル** - スクリーンショットや図を渡して機能を実装 ✨

そして、**完全にオープンソース**なので、プロジェクトの開発状況を確認して、気軽に貢献していただけます。

---

## セキュリティモデルと権限

Codexは`--approval-mode`フラグ（または対話型のオンボーディングプロンプト）を通じて、エージェントが受け取る_自律性の度合い_と自動承認ポリシーを決定できます：

| モード                      | エージェントが許可なく実行できること                                                               | 承認が必要な操作                                                                         |
| ------------------------- | -------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| **Suggest** <br>(デフォルト) | • リポジトリ内の任意のファイルの読み取り                                                                        | • **すべての**ファイル書き込み/パッチ <br>• **任意の**シェルコマンド（ファイル読み取りを除く） |
| **Auto Edit**             | • ファイルの読み取り**と**パッチ適用による書き込み                                                         | • **すべての**シェルコマンド                                                                        |
| **Full Auto**             | • ファイルの読み書き <br>• シェルコマンドの実行（ネットワーク無効化、書き込みは作業ディレクトリに限定） | –                                                                                               |

**Full Auto**モードでは、すべてのコマンドが**ネットワーク無効化**され、現在の作業ディレクトリ（および一時ファイル）に制限されて、防御を深めています。また、ディレクトリがGitで追跡されていない状態で**auto-edit**または**full-auto**モードで開始すると、警告/確認が表示されるため、常にセーフティネットが用意されています。

近日公開予定：十分な検証が完了したタイミングで、特定のコマンドをネットワーク有効で自動実行するようにホワイトリスト化できるようになります。

### プラットフォームサンドボックス詳細

Codexで採用されるセキュリティ強化の仕組みは、使用するOSによって異なります。

- **macOS 12+** - コマンドは**Apple Seatbelt**（`sandbox-exec`）でラップされます。

  - 書き込み可能なルート（`$PWD`、`$TMPDIR`、`~/.codex`など）の小さなセットを除き、すべてが読み取り専用の保護領域に配置されます。
  - アウトバウンドネットワークは_完全にブロック_されます - 子プロセスが`curl`を試みても失敗します。

- **Linux** - デフォルトではサンドボックス化はありません。
  Dockerを使用してサンドボックス化することをお勧めします。Codexは**最小限のコンテナイメージ**内で起動し、リポジトリを同じパスに_読み書き可能な状態_としてマウントします。カスタムの`iptables`/`ipset`ファイアウォールスクリプトは、OpenAI APIを除くすべてのエグレスを拒否します。これにより、ホストでroot権限がなくても、決定的で再現性のある実行が可能になります。[`run_in_container.sh`](./codex-cli/scripts/run_in_container.sh)スクリプトを使用してサンドボックスを設定できます。

---

## システム要件

| 要件                 | 詳細                                                         |
| --------------------------- | --------------------------------------------------------------- |
| オペレーティングシステム           | macOS 12+、Ubuntu 20.04+/Debian 10+、またはWindows 11 **WSL2経由** |
| Node.js                     | **22以降**（LTS推奨）                               |
| Git（オプション、推奨） | 2.23+（組み込みPRヘルパー用）                                   |
| RAM                         | 最小4GB（8GB推奨）                                 |

> `sudo npm install -g`は絶対に実行しないでください。代わりにnpmの権限を修正してください。

---

## CLIリファレンス

| コマンド                              | 目的                             | 例                              |
| ------------------------------------ | ----------------------------------- | ------------------------------------ |
| `codex`                              | 対話型REPL                    | `codex`                              |
| `codex "..."`                          | 対話型REPLの初期プロンプト | `codex "fix lint errors"`            |
| `codex -q "..."`                       | 非対話型「サイレントモード」        | `codex -q --json "explain utils.ts"` |
| `codex completion <bash\|zsh\|fish>` | シェル補完スクリプトの出力       | `codex completion bash`              |

主要なフラグ：`--model/-m`、`--approval-mode/-a`、`--quiet/-q`、`--notify`。

---

## メモリとプロジェクトドキュメント

Codexは以下の順序でMarkdown指示をマージします：

1. `~/.codex/instructions.md` - 個人用グローバルガイダンス
2. リポジトリルートの`codex.md` - 共有プロジェクトノート
3. カレントワーキングディレクトリの`codex.md` - サブパッケージ固有の指示

`--no-project-doc`または`CODEX_DISABLE_PROJECT_DOC=1`で無効化できます。

---

## 非対話型/CIモード

パイプラインでヘッドレスでCodexを実行します。GitHub Actionsステップの例：

```yaml
- name: Codex経由で変更履歴を更新
  run: |
    npm install -g @openai/codex
    export OPENAI_API_KEY="${{ secrets.OPENAI_KEY }}"
    codex -a auto-edit --quiet "次のリリース用にCHANGELOGを更新"
```

`CODEX_QUIET_MODE=1`を設定すると、対話型UIのノイズを抑制できます。

## トレース/詳細ログ

環境変数`DEBUG=true`を設定すると、完全なAPIリクエストとレスポンスの詳細が出力されます：

```shell
DEBUG=true codex
```

---

## レシピ

以下はコピー＆ペーストできるいくつかの簡単な例です。引用符内のテキストを自分のタスクに置き換えてください。より多くのヒントと使用パターンについては[プロンプトガイド](https://github.com/openai/codex/blob/main/codex-cli/examples/prompting_guide.md)を参照してください。

| ✨  | 入力内容                                                                   | 実行結果                                                               |
| --- | ------------------------------------------------------------------------------- | -------------------------------------------------------------------------- |
| 1   | `codex "DashboardコンポーネントをReact Hooksにリファクタリング"`                       | Codexがクラスコンポーネントを書き直し、`npm test`を実行し、差分を表示します。   |
| 2   | `codex "ユーザーテーブルを追加するSQLマイグレーションを生成"`                      | ORMを推測し、マイグレーションファイルを作成し、サンドボックス化されたDBで実行します。 |
| 3   | `codex "utils/date.tsのユニットテストを作成"`                                    | テストを生成し、実行し、合格するまで反復します。              |
| 4   | `codex "git mvで*.jpegを*.jpgに一括リネーム"`                                | ファイルを安全にリネームし、インポート/使用箇所を更新します。                           |
| 5   | `codex "この正規表現の説明：^(?=.*[A-Z]).{8,}$"`                      | ステップバイステップの人間が理解できる説明を出力します。                                  |
| 6   | `codex "このリポジトリを注意深くレビューし、3つの高影響力で適切にスコープされたPRを提案"` | 現在のコードベースで影響力のあるPRを提案します。                            |
| 7   | `codex "脆弱性を探してセキュリティレビューレポートを作成"`          | セキュリティバグを見つけて説明します。                                          |

---

## インストール

<details open>
<summary><strong>npmから（推奨）</strong></summary>

```bash
npm install -g @openai/codex
# または
yarn global add @openai/codex
# または
bun install -g @openai/codex
# または
pnpm add -g @openai/codex
```

</details>

<details>
<summary><strong>ソースからビルド</strong></summary>

```bash
# リポジトリをクローンし、CLIパッケージに移動
git clone https://github.com/openai/codex.git
cd codex/codex-cli

# corepackを有効化
corepack enable

# 依存関係をインストールしてビルド
pnpm install
pnpm build

# 使用方法とオプションを取得
node ./dist/cli.js --help

# CLIを直接実行
node ./dist/cli.js

# または、利便性のためにコマンドをグローバルにリンク
pnpm link
```

</details>

---

## 設定

Codexは**`~/.codex/`**内の設定ファイルを探します（YAMLまたはJSON形式）。

```yaml
# ~/.codex/config.yaml
model: o4-mini # デフォルトモデル
approvalMode: suggest # または auto-edit, full-auto
fullAutoErrorMode: ask-user # または ignore-and-continue
notify: true # レスポンスのデスクトップ通知を有効化
safeCommands:
  - npm test # npm testを自動承認
  - yarn lint # yarn lintを自動承認
```

```json
// ~/.codex/config.json
{
  "model": "o4-mini",
  "approvalMode": "suggest",
  "fullAutoErrorMode": "ask-user",
  "notify": true
}
```

カスタム指示を定義することもできます：

```yaml
# ~/.codex/instructions.md
- 常に絵文字で応答する
- 明示的に言及した場合のみgitコマンドを使用する
```

---

## FAQ

<details>
<summary>OpenAIは2021年にCodexというモデルをリリースしましたが、これは関連していますか？</summary>

2021年、OpenAIは自然言語プロンプトからコードを生成するように設計されたAIシステムであるCodexをリリースしましたが、そのCodexモデルは2023年3月に廃止され、このCLIツールとは異なります。

</details>

<details>
<summary>どのモデルがサポートされていますか？</summary>

[Responses API](https://platform.openai.com/docs/api-reference/responses)で利用可能な任意のモデル。デフォルトは`o4-mini`ですが、`--model gpt-4.1`を渡すか、設定ファイルで`model: gpt-4.1`を設定することで上書きできます。

</details>

<details>
<summary>なぜ<code>o3</code>や<code>o4-mini</code>が動作しないのですか？</summary>

[APIアカウントの検証](https://help.openai.com/en/articles/10910291-api-organization-verification)が必要な可能性があります。これにより、APIからのレスポンスのストリーミングと思考の連鎖の要約が表示されるようになります。まだ問題が発生している場合は、お知らせください！

</details>

<details>
<summary>Codexがファイルを編集するのを止めるにはどうすればよいですか？</summary>

Codexは、AIが生成したコマンドをサンドボックス環境で実行します。提案されたコマンドやファイルの変更が正しくないように見える場合は、単純に**n**と入力してコマンドを拒否するか、モデルにフィードバックを与えることができます。

</details>

<details>
<summary>Windowsで動作しますか？</summary>

直接は動作しません。[Windows Subsystem for Linux (WSL2)](https://learn.microsoft.com/en-us/windows/wsl/install)が必要です - CodexはmacOSとLinuxでNode ≥ 22でテストされています。

</details>

---

## ゼロデータ保持（ZDR）組織制限

> **注意:** Codex CLIは現在、[ゼロデータ保持（ZDR）](https://platform.openai.com/docs/guides/your-data#zero-data-retention)が有効なOpenAI組織をサポートしていません。

OpenAI組織でゼロデータ保持が有効になっている場合、以下のようなエラーが発生する可能性があります：

```
OpenAIがリクエストを拒否しました。エラー詳細：ステータス：400、コード：unsupported_parameter、タイプ：invalid_request_error、メッセージ：400 ゼロデータ保持のため、この組織では前のレスポンスを使用できません。
```

**なぜ？**

- Codex CLIは内部推論ステップを有効にするために、`store:true`のResponses APIに依存しています。
- [ドキュメント](https://platform.openai.com/docs/guides/your-data#responses-api)に記載されているように、Responses APIはデフォルトで、または`store`パラメータが`true`に設定されている場合、30日間の保持期間を必要とします。
- ZDR組織は`store:true`を使用できないため、リクエストは失敗します。

**どうすればよいですか？**

- ZDR組織の一員である場合、サポートが追加されるまでCodex CLIは動作しません。
- この制限について、サポートが利用可能になった場合はドキュメントを更新します。

---

## 資金提供の機会

Codex CLIや他のOpenAIモデルを使用するオープンソースプロジェクトを支援する**100万ドルの支援プログラム**を開始することを喜ばしく思います。

- 助成金は**25,000ドル**のAPIクレジット単位で授与されます。
- 申請は**随時**審査されます。

**興味がありましたら[こちらから申請してください](https://openai.com/form/codex-open-source-fund/)。**

---

## 貢献

このプロジェクトは現在開発中であり、コードは大幅に変更される可能性が高いです。完了したらこのメッセージを更新します！

より広く、私たちは貢献を歓迎します - 初めてのプルリクエストを開く方でも、経験豊富なメンテナーでも。同時に、信頼性と長期的な保守性を重視しているため、コードのマージのハードルは意図的に**高く**設定されています。以下のガイドラインは、「高品質」が実際に何を意味するのかを明確にし、プロセス全体を透明でフレンドリーにするはずです。

### 開発ワークフロー

- `main`から_トピックブランチ_を作成 - 例：`feat/interactive-prompt`
- 変更を集中させてください。複数の無関係な修正は別々のPRとして開いてください。
- 開発中は`pnpm test:watch`を使用して超高速なフィードバックを得てください。
- ユニットテストには**Vitest**、スタイルには**ESLint** + **Prettier**、型チェックには**TypeScript**を使用しています。
- プッシュ前に、完全なテスト/型/リントスイートを実行してください：

### Huskyを使用したGitフック

このプロジェクトは[Husky](https://typicode.github.io/husky/)を使用してコード品質チェックを強制します：

- **コミット前フック**：コミット前にlint-stagedを自動実行してファイルをフォーマットし、リントします
- **プッシュ前フック**：リモートにプッシュする前にテストと型チェックを実行します

これらのフックはコード品質を維持し、テストが失敗しているコードのプッシュを防ぐのに役立ちます。詳細については[HUSKY.md](./codex-cli/HUSKY.md)を参照してください。

```bash
npm test && npm run lint && npm run typecheck
```

- **まだ**貢献者ライセンス契約（CLA）に署名していない場合は、PRコメントに以下の正確なテキストを追加してください：

  ```text
  CLAドキュメントを読み、ここにCLAに署名します
  ```

  CLAアシスタントボットは、すべての著者が署名するとPRステータスを緑色に変更します。

```bash
# ウォッチモード（変更時にテストを再実行）
pnpm test:watch

# ファイルを出力せずに型チェック
pnpm typecheck

# リントとprettierの問題を自動修正
pnpm lint:fix
pnpm format:fix
```

#### Nix Flake開発

前提条件：Nix >= 2.4でフレークが有効（`~/.config/nix/nix.conf`で`experimental-features = nix-command flakes`）。

Nix開発シェルに入る：

```bash
nix develop
```

このシェルにはNode.jsが含まれ、依存関係をインストールし、CLIをビルドし、`codex`コマンドエイリアスを提供します。

CLIを直接ビルドして実行：

```bash
nix build
./result/bin/codex --help
```

フレークアプリ経由でCLIを実行：

```bash
nix run .#codex
```

### 重大なコード変更

1. **問題から始める。** 新しい問題を開くか、既存のディスカッションにコメントして、コードが書かれる前に解決策に合意できるようにします。
2. **テストを追加または更新する。** すべての新機能やバグ修正には、変更前に失敗し、変更後に合格するテストカバレッジが必要です。100%のカバレッジは必要ありませんが、意味のあるアサーションを目指してください。
3. **動作を文書化する。** 変更がユーザー向けの動作に影響する場合は、README、インラインヘルプ（`codex --help`）、または関連するサンプルプロジェクトを更新してください。
4. **コミットをアトミック（単一目的）に保つ。** 各コミットはコンパイルでき、テストは合格する必要があります。これにより、レビューと潜在的なロールバックが容易になります。

### プルリクエストの作成

- PRテンプレートを記入する（または同様の情報を含める）- **何を？なぜ？どのように？**
- **すべての**チェックをローカルで実行（`npm test && npm run lint && npm run typecheck`）。ローカルで検出可能なCIの失敗はプロセスを遅らせます。
- ブランチが`main`と最新であること、マージの競合が解決されていることを確認してください。
- PRがマージ可能な状態であると確信した場合にのみ、**レビュー準備完了**としてマークしてください。

### レビュープロセス

1. 1人のメンテナーがプライマリレビュアーとして割り当てられます。
2. 変更を要求する場合があります - これを個人的に受け取らないでください。私たちは作業を評価していますが、一貫性と長期的な保守性も重視しています。
3. PRが基準を満たすという合意が得られた場合、メンテナーがsquash-and-mergeを行います。

### コミュニティの価値観

- **親切で包括的であること。** 他の人を尊重して扱う。[Contributor Covenant](https://www.contributor-covenant.org/)に従います。
- **善意を前提とする。** 書面によるコミュニケーションは難しい - 寛大さを優先してください。
- **教え、学ぶ。** 混乱を招くものを見つけたら、改善のためのissueやPRを開いてください。

### ヘルプの入手

プロジェクトのセットアップで問題が発生した場合、アイデアについてフィードバックが欲しい場合、または単に_こんにちは_と言いたい場合 - ディスカッションを開くか、関連するissueに参加してください。

### 貢献者ライセンス契約（CLA）

すべての貢献者は**必ず**CLAを受け入れる必要があります。プロセスは軽量です：

1. プルリクエストを開きます。
2. 以下のコメントを貼り付けます（または以前に署名した場合は`recheck`と返信）：

   ```text
   CLAドキュメントを読み、ここにCLAに署名します
   ```

3. CLAアシスタントボットがリポジトリに署名を記録し、ステータスチェックを合格としてマークします。

特別なGitコマンド、メール添付ファイル、またはコミットフッターは必要ありません。

#### クイックフィックス

| シナリオ          | コマンド                                                                                   |
| ----------------- | ----------------------------------------------------------------------------------------- |
| 最後のコミットを修正 | `git commit --amend -s --no-edit && git push -f`                                          |
| GitHub UIのみ    | PRでコミットメッセージを編集 → 追加<br>`Signed-off-by: あなたの名前 <email@example.com>` |

**DCOチェック**は、PR内のすべてのコミットがフッターを保持するまでマージをブロックします（squashの場合は1つだけ）。

### `codex`のリリース

CLIの新しいバージョンを公開するには、`codex-cli/package.json`で定義されているリリーススクリプトを実行します：

1. `codex-cli`ディレクトリを開きます
2. `git checkout -b bump-version`のようなブランチにいることを確認します
3. バージョンと`CLI_VERSION`を現在の日時に更新：`pnpm release:version`
4. バージョン更新をコミット（DCO署名付き）：
   ```bash
   git add codex-cli/src/utils/session.ts codex-cli/package.json
   git commit -s -m "chore(release): codex-cli v$(node -p \"require('./codex-cli/package.json').version\")"
   ```
5. READMEをコピーし、ビルドしてnpmに公開：`pnpm release`
6. ブランチにプッシュ：`git push origin HEAD`

---

## セキュリティと責任あるAI

脆弱性を発見した場合や、モデルの出力について懸念がある場合は、**security@openai.com**にメールでお知らせください。迅速に対応いたします。

---

## ライセンス

このリポジトリは[Apache-2.0ライセンス](LICENSE)の下でライセンスされています。